# UNIX/Linux operating systems (Basic). 

1. [Установка ОС](#установка-ос)
2. [Создание нового пользователя](#создание-нового-пользователя)
3. [Настройка сети ОС](#настройка-сети-ос)
4. [Обновление ОС](#обновление-ос)
5. [Использование команды sudo](#использование-команды-sudo)
6. [Установка и настройка службы времени](#установка-и-настройка-службы-времени)
7. [Установка и использование текстовых редакторов](#установка-и-использование-текстовых-редакторов)
    1. [VIM](#vim)
    2. [NANO](#nano)
    3. [MCEDIT](#mcedit)
8. [Установка и базовая настройка сервиса SSHD](#установка-и-базовая-настройка-сервиса-sshd)
9. [Установка и использование утилит top, htop](#установить-и-запустить-утилиты-top-и-htop)
10. [Использование утилиты fdisk](#использование-утилиты-fdisk)
11. [Использование утилиты df](#использование-утилиты-df)
12. [Использование утилиты du](#использование-утилиты-du)
13. [Установка и использование утилиты ncdu](#установка-и-использование-утилиты-ncdu)
14. [Работа с системными журналами](#работа-с-системными-журналами)
15. [Использование планировщика заданий CRON](#использование-планировщика-заданий-cron)

## [Установка ОС](#установка-ос)

(Сами шаги предоврительной установки и настройки пропущены). <br>
Чтобы узнать версию установленой ОС требуется ввести в командную строку
``` bash
$ cat /etc/issue
```
> Версии могут отличаться.

![Версия](./assets/1.png)

## Создание нового пользователя

Для того чтобы создать нового пользователя введите следующую команду. 
``` bash
$ sudo adduser -G adm user-1
$ cat /etc/passwd | grep user-1
$ sudo passwd user-1
```
Результат выполения команд. <br>
![Новый пользователь](./assets/2.png)

## Настройка сети ОС
1. Устанавливаем новое имя машины.
``` bash
$ hostnamectl set-hostname user-1
```
![Новое имя машины](./assets/3.png)

2. Устанавливаем временную зону, соответствующую вашему текущему местоположению.

``` bash
$ sudo timedatectl
$ sudo timedatectl set-timezone Europe/Moscow
$ sudo timedatectl
```

![Новая таймзона](./assets/4.png)

3. Вывести названия сетевых интерфейсов с помощью консольной команды.
Для этого надо установить набор сетевых инструментов.
``` bash
$ sudo apt install net-tools
```

![Текущие подключения](./assets/5.png)

> `lo` или `local loopback` (локальная петля) – виртуальный интерфейс, присутствующий по умолчанию в любом Linux. Он используется для отладки сетевых программ и запуска серверных приложений на локальной машине. С этим интерфейсом всегда связан адрес 127.0.0.1. У него есть dns-имя – localhost.

4. Используя консольную команду получить ip адрес устройства, на котором вы работаете, от DHCP сервера.
``` bash 
$ hostname -I
```
![Текущий ip](./assets/7.png)

> Dynamic Host Configuration Protocol (DHCP) — автоматический предоставляет IP адреса и прочие настройки сети (маску сети, шлюз и т.п) компьютерам и различным устройствам в сети.

5. Определить и вывести на экран внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза, он же ip-адрес по умолчанию (gw).

> Так мы можем определить наш внешний ip-адрес шлюза (ip):
``` bash
$ wget -O - -q icanhazip.com
$ curl ifconfig.me/ip
```
![Внешний ip](./assets/8.png)

> Так мы можем определить наш внутренний IP-адрес шлюза:

``` bash 
$ ip route
```
![Внутренний ip](./assets/9.png)

6. Задать статичные (заданные вручную, а не полученные от DHCP сервера) настройки ip, gw, dns (использовать публичный DNS серверы, например 1.1.1.1 или 8.8.8.8).

``` bash
$ sudo vim /etc/netplan/00-installer-config.yaml
```
![измененный netplan](./assets/10.png)

 > Изменили файл /etc/netplan/00-installer-config.yaml, применили изменения в netplan, перезагрузили машину.
``` bash
$ sudo netplan apply
$ reboot
```
> Проверяем, что адреса соотсветствуют заданным в предыдущем пункте.
``` bash
$ ifconfig
```
![проверка адреса](./assets/11.png)

> Проверяем успешноли пропингуются удаленные хосты 1.1.1.1 и ya.ru
``` bash
$ ping 1.1.1.1
$ ping ya.ru
```
![пингуем 1.1.1.1 ya.ru](./assets/11.png)

## Обновление ОС

> Обновить системные пакеты до последней на момент выполнения задания версии.

``` bash
$ sudo apt update
```

![Обновление ОС](./assets/12.png)

## Использование команды sudo

> Разрешить пользователю, созданному в [Part 2](#создание-нового-пользователя), выполнять команду sudo. <br>
`sudo` — это утилита, предоставляющая привилегии root для выполнения административных операций в соответствии со своими настройками. Она позволяет легко контролировать доступ к важным приложениям в системе. По умолчанию, при установке Ubuntu первому пользователю (тому, который создаётся во время установки) предоставляются полные права на использование sudo. Т.е. фактически первый пользователь обладает той же свободой действий, что и root.

``` bash
$ sudo usermod -a -G sudo user-1
$ su user-1
$ cat /etc/hostname
$ sudo hostname user-2
$ su sullustg
```
![Выдача прав новому пользователю](./assets/15.png)

## Установка и настройка службы времени

Чтобы настроить службу автоматической синхронизации времени.
``` bash
$ sudo timedatectl
$ timdatectl show
```
![Выдача прав новому пользователю](./assets/16.png)

## Установка и использование текстовых редакторов

1. Установить текстовые редакторы VIM (+ любые два по желанию NANO, MCEDIT, JOE и т.д.)
``` bash 
$ sudo apt install vim
$ sudo apt install nano
$ sudo apt install mcedit
```
2. Используя каждый из трех выбранных редакторов, создайте файл `test_X.txt`, где `X` -- название редактора, в котором создан файл. Напишите в нём свой никнейм, закройте файл с сохранением изменений.
3. Используя каждый из трех выбранных редакторов, откройте файл на редактирование, отредактируйте файл, заменив никнейм на строку "21 School 21", закройте файл без сохранения изменений.
4. Используя каждый из трех выбранных редакторов, отредактируйте файл ещё раз (по аналогии с предыдущим пунктом), а затем освойте функции поиска по содержимому файла (слово) и замены слова на любое другое.

### VIM
> vim test_vim.txt \
> Режим редактирования `i` \
> Выйти из режима редактирования: `Esc` \
> Выход с сохранением: `:wq` \
> Выход без сохранения: `:q!`\
> Поиск: `/<Что хотим найти>` \
> Замена: `:s/<ЧТО>/<НА ЧТО>`

1. ![VIM](./assets/17.png)

2. ![VIM](./assets/20.png)

3. ![VIM](./assets/23.png)

4. ![VIM](./assets/24.png)

### NANO

> nano test_nano.txt \
> Выход с сохранением: `CTRL + X`, затем `Y` и `ENTER` \
> Выход без сохранения: `CTRL + X`, затем `N` \
> Поиск: `CTRL + W`, <Что ищем> затем `ENTER`. \
> Для перехода к следующему совпадению `ALT + W`, для прекращения поиска `ALT + C`. \
> Замена: `CTRL + \` + `<ЧТО + ENTER>` + `<НА ЧТО + ENTER>` - `A` - ALL || `Y` - YES || `N` - NO

1. ![NANO](./assets/18.png)

2. ![NANO](./assets/21.png)

3. ![NANO](./assets/25.png)

4. ![NANO](./assets/26.png)



### MCEDIT

> mcedit test_mcedit.txt \
> Выход с сохранением: `F2 <YES> + F10` \
> Выход без сохранения: `F10 <NO>` \
> Поиск: `F7` + <Что ищем> + `<OK> || <FIND ALL>` \
> Замена: `F4` + <ЧТО> + <НА ЧТО> + `<REPLACE> || <ALL> || <SKIP>`

1. ![MCEDIT](./assets/19.png)

2. ![MCEDIT](./assets/22.png)

3. ![MCEDIT](./assets/27.png)

4. ![MCEDIT](./assets/28.png)

## Установка и базовая настройка сервиса SSHD

1. Установить службу SSHd.

``` bash
$ sudo apt-get install ssh
$ sudo apt install openssh-server
```
![SSHD](./assets/30.png)

2. Добавить автостарт службы при загрузке системы.

``` bash
$ sudo systemctl enable ssh
$ systemctl status ssh
```

![SSH ENABLE](./assets/31.png)

3. Перенастроить службу SSHd на порт 2022.
``` bash
$ sudo vim /etc/ssh/sshd_config
$ systemctl restart sshd
```
![SSHd](./assets/32.png)

4. Используя команду ps, показать наличие процесса sshd. Для этого к команде нужно подобрать ключи.

- `ps` (показывает запущенные процессы, выполняемые пользователем в окне терминала);
- `ps -e` или `ps -A` (Чтобы просмотреть все запущенные процессы);
- `ps -d` (Чтобы показать все процессы, кроме лидеров сессии);
- `ps -d -N` (можно инвертировать вывод с помощью переключателя `-N`. Например, если хочу вывести только лидеров сеансов)
- `ps T` (увидеть только процессы, связанные с этим терминалом);
- `ps r` (просмотреть все работающие (`running`) процессы);
- `ps -p 'pid'` (если вы знаете идентификатор процесса PID, вы можете просто использовать следующую команду, для вывода процесса с этим `'pid'`);
- `ps -p 'pid1' 'pid2'`
- `ps U 'userlist'` (найти все процессы, выполняемые конкретным пользователем);
- `ps -ef` (получить полный список); 

``` bash 
$ ps -e | grep sshd
```
![ps](./assets/33.png)

5. Перезагрузить систему.

``` bash
$ service ssh restart
$ reboot
$ netstat -tan 
```
![netstat](./assets/34.png)

- `-t (--tcp)` отображает соедниеня только по tcp
- `-a (--all)` вывод всех активных подключений TCP
- `-n (--numeric)` вывод активных подключений TCP с отображением адресов и номеров портов в числовом формате
- `Proto:` Название протокола (протокол TCP или протокол UDP);
- `recv-Q:` очередь получения сети
- `send-Q:` Сетевая очередь отправки
- `Local Address` адрес локального компьтера и используемы номер порта
- `Foreign Address` адрес и номер удаленного компьтера к которомц подключен сокет
- `State` состояние сокетв
- `0.0.0.0` означает IP-адрес на локальной машине

## Установка и использование утилит top, htop

### Установить и запустить утилиты top и htop.

``` bash 
$ sudo apt install htop
$ htop
```

1. По выводу команды top определить и написать в отчёте:
* uptime - 7.45min;
* количество авторизованных пользователей - 1;
* общая загрузку системы - 0.00, 0.00, 0.00;
* общее количество процессов - 25;
* загрузку cpu - 0.0%;
* загрузку памяти - 140M/1.93G;
* pid процесса занимающего больше всего памяти - 355 (top -o %MEM);
* pid процесса, занимающего больше всего процессорного времени - 1 (top -o %CPU);

![htop](./assets/35.png)

2. В отчёт вставить скрин с выводом команды htop:
отсортированному по `PID`, `PERCENT_CPU`, `PERCENT_MEM`, `TIME`.

### SORT BY PID
![PID](./assets/36.png)
### SORT BY PERCENT_CPU
![PERCENT_CPU](./assets/37.png)
### SORT BY PERCENT_MEM
![PERCENT_MEM](./assets/38.png)
### SORT BY TIME
![TIME](./assets/39.png)

### FILTER 'sshd'
![FILTER sshd](./assets/40.png)
### SEARCH 'syslog'
![SEARCH syslog](./assets/41.png)
### C добавленным выводом hostname, clock и uptime
![htop hostname](./assets/42.png)

## Использование утилиты fdisk

``` bash 
$ sudo fdisk -l
$ sudo 
```
> Название диска: VBOX HARDDISK \
> Размер: 10 GiB \
> Количество секторов: 20971520 \
> Размер swap: 1.5G 


![fdisk](./assets/43.png)

> Если у вас нет файла подкачки.
``` bash 
$ sudo fallocate -l 2G /swapfile
$ ls -lh /swapfile
$ sudo chmod 600 /swapfile
$ ls -lh /swapfile
$ sudo mkswap /swapfile
$ sudo swapon /swapfile
$ swapon --show || free -h
```
![swap](./assets/44.png)

## Использование утилиты df

1. `df` для корневого раздела (/):
``` bash 
$ df
```
* Размер раздела - 8408452;
* Размер занятого пространства - 4214384;
* Размер свободного пространства - 3745352;
* Процент использования - 53%;
* Единица измерения в выводе - килобайт.

![df](./assets/45.png)

2. `df -Th` для корневого раздела (/):
``` bash 
$ df -Th
```
* Размер раздела - 8.1G;
* Рразмер занятого пространства - 4.1G;
* Размер свободного пространства - 3.6G;
* Процент использования - 53%
* Тип файловой системы для раздела - ext4.

![df -Th](./assets/46.png)

## Использование утилиты du
1. Вывести размер папок `/home`, `/var`, `/var/log` (в человекочитаемом виде)
``` bash 
$ sudo du -sh /var/log /var /home  
```
![du -sh](./assets/47.png)
2. Вывести размер папок `/home`, `/var`, `/var/log` (в байтах) 
``` bash 
$ sudo du -s --block-size=1 /var/log /var /home  
```
![du -s](./assets/48.png)
3. Вывести размер всего содержимого в `/var/log` (не общее, а каждого вложенного элемента, используя `*`)
``` bash 
$ sudo du -sh /var/log/*  
```
![du -sh *](./assets/49.png)

## Установка и использование утилиты ncdu

``` bash 
$ sudo apt install ncdu
$ sudo ncdu
```
![ncdu](./assets/50.png)

- Вывести размер папок `/home`, `/var`, `/var/log`.

### `/home`
![ncdu /home](./assets/51.png)

### `/var`
![ncdu /var](./assets/52.png)

### `/var/log`
![ncdu /var/log](./assets/53.png)

## Работа с системными журналами

- Открыть для просмотра:

1. `/var/log/dmesg`

``` bash 
$ sudo vim /var/log/dmesg
```
![sudo vim /var/log/dmesg](./assets/54.png)
2. `/var/log/syslog`

``` bash 
$ sudo vim /var/log/syslog
```
![sudo vim /var/log/syslog](./assets/55.png)

3. `/var/log/auth.log`

``` bash 
$ sudo vim /var/log/auth.log
```
![sudo vim /var/log/auth.log](./assets/56.png)

* Последняя успешная авторизация: Oct 5 14:22:57;
* Имя пользователя: sullustg;
* Метод входа в систему: pam-unix.

4. `Перезапустить службу SSHd.`

``` bash 
$ sudo systemctl restart ssh
```
![restart ssh](./assets/57.png)


## Использование планировщика заданий CRON

``` bash 
$ sudo crtontab -e
```
![crtontab -e](./assets/58.png)

1. Используя планировщик заданий, запустим команду uptime через каждые 2 минуты.

``` vim 
*/2 * * * * uptime
```

2. Найти в системных журналах строчки (минимум две в заданном временном диапазоне) о выполнении.

![log cron](./assets/59.png)

3. Вывести на экран список текущих заданий для CRON.

``` bash 
$ sudo crtontab -l
```
![log cron](./assets/60.png)

4. Удалить все задания из планировщика заданий.

``` bash 
$ sudo crtontab -r
$ sudo crtontab -l
```
![del cron](./assets/61.png)
